# 一、核心组件

|部件|	推荐型号|	说明|
|------|--------|-------|
|主控|	ESP32|	支持WiFi/蓝牙，多串口
|舵机|	UBT舵机或MG996R|	需支持角度控制（如180°范围）
|电源|	12V锂电池+降压模块|	需满足舵机峰值电流
|音频模块|	KT404A或DFPlayer|	MP3播放，支持串口控制
|存储|	SPIFFS（内置Flash）|	存储动作文件
|扩展|	LED灯带、陀螺仪	|增强效果或平衡检测

# 二、硬件连接

* 舵机：通过舵机总线（如串口）或PWM引脚连接。

* 音频模块：接ESP32的串口（如UART1）。

* 电源：

    * 主控用5V供电。

    * 舵机单独供电（避免电流不足）。

# 三、软件设计

## 3.1 固件开发

* 关键模块：

    * 舵机控制：使用 CServoManager 类管理多舵机。

    * 动作存储：SPIFFS存储动作文件（如JSON或二进制格式）。

    * 通信协议：基于 CProtoSerial 实现与APP的指令交互。

    * 音乐同步：通过 CKT404A 控制MP3播放节奏。

## 3.2 动作设计

* 步骤：

    1. 分解动作：将舞蹈拆解为关键帧（如每100ms一帧）。

    2. 录制工具：

        * 使用 CHandler::StartTeach() 进入教学模式。

        * 手动调整舵机姿势，保存为动作帧。

    3. 导出文件：存储为 /actions/dance1.bin。

* 动作文件结构

```c++
struct DancePose {
    uint16_t angles[16]; // 16个舵机角度
    uint32_t durationMs; // 过渡时间
};
```

## 3.3 无线方案

* 方案：

    * WiFi AP模式：机器人作为热点，手机直连。

    * 协议：自定义二进制协议（如示例中的 0xFB 0xBF 格式）。

# 四、调试与优化

* 舵机校准：

    * 使用 CServoManager::SetOffset() 调整机械偏差。

    * 测试极限角度，避免堵转。

* 动作流畅性：

    * 调整帧间隔时间（如 waitMsec）。

    * 添加运动曲线（如缓动算法）。

* 功耗管理：

    * 空闲时锁定舵机（LockServos()）。

    * 动态调整CPU频率。


# 五、拓展功能（可选）

* 音乐同步：

    * 解析MP3节奏，触发动作帧。

    * 示例：检测音频峰值，切换舞蹈段落。

* 视觉反馈：

    * 添加摄像头，实现动作跟随或人脸互动。

* 云控制：

    * 通过MQTT接入物联网平台，远程更新舞蹈。

# 六、流程图

<div><img src="https://cdn.jsdelivr.net/gh/lcekold/blogimage@main/Network/deepseek_mermaid_20250529_5d2384.png"></div>

